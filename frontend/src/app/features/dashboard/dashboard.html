<div class="dashboard-container">
  <!-- Header -->
  <header class="dashboard-header">
    <div class="header-content">
      <div class="header-left">
        <h1>Dashboard de Empleados</h1>
        <p>Gestiona tu equipo de trabajo</p>
      </div>
      <div class="header-right">
        <span class="user-info">Bienvenido, {{ currentUser?.username }}</span>
        <button class="btn-logout" (click)="logout()">
          <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"></path>
            <polyline points="16 17 21 12 16 7"></polyline>
            <line x1="21" y1="12" x2="9" y2="12"></line>
          </svg>
          Cerrar Sesión
        </button>
      </div>
    </div>
  </header>

  <!-- Main Content -->
  <main class="dashboard-main">
    <!-- Actions Bar -->
    <div class="actions-bar">
      <button class="btn-primary" (click)="openCreateModal()">
        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <line x1="12" y1="5" x2="12" y2="19"></line>
          <line x1="5" y1="12" x2="19" y2="12"></line>
        </svg>
        Nuevo Empleado
      </button>
      <div class="search-box">
        <svg class="search-icon" xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <circle cx="11" cy="11" r="8"></circle>
          <path d="m21 21-4.35-4.35"></path>
        </svg>
        <input type="text" placeholder="Buscar empleado..." [(ngModel)]="searchTerm" (input)="filterEmployees()">
      </div>
    </div>

    <!-- Loading State -->
    <div class="loading-container" *ngIf="loading">
      <div class="spinner"></div>
      <p>Cargando empleados...</p>
    </div>

    <!-- Empty State -->
    <div class="empty-state" *ngIf="!loading && filteredEmployees.length === 0 && !searchTerm">
      <svg xmlns="http://www.w3.org/2000/svg" width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
        <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
        <circle cx="9" cy="7" r="4"></circle>
        <path d="M23 21v-2a4 4 0 0 0-3-3.87"></path>
        <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
      </svg>
      <h3>No hay empleados registrados</h3>
      <p>Comienza agregando tu primer empleado</p>
      <button class="btn-primary" (click)="openCreateModal()">Agregar Empleado</button>
    </div>

    <!-- No Results State -->
    <div class="empty-state" *ngIf="!loading && filteredEmployees.length === 0 && searchTerm">
      <svg xmlns="http://www.w3.org/2000/svg" width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
        <circle cx="11" cy="11" r="8"></circle>
        <path d="m21 21-4.35-4.35"></path>
      </svg>
      <h3>No se encontraron resultados</h3>
      <p>Intenta con otro término de búsqueda</p>
    </div>

    <!-- Employees Table -->
    <div class="table-container" *ngIf="!loading && filteredEmployees.length > 0">
      <table class="employees-table">
        <thead>
          <tr>
            <th>Código</th>
            <th>Nombre</th>
            <th>Apellidos</th>
            <th>Departamento</th>
            <th>Fecha de Creación</th>
            <th>Acciones</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let employee of filteredEmployees" class="employee-row">
            <td><span class="badge">{{ employee.code }}</span></td>
            <td>{{ employee.firstName }}</td>
            <td>{{ employee.lastName1 }} {{ employee.lastName2 || '' }}</td>
            <td>{{ employee.departmentCode }}</td>
            <td>{{ employee.createdAt | date:'dd/MM/yyyy' }}</td>
            <td>
              <div class="action-buttons">
                <button class="btn-icon btn-edit" (click)="openEditModal(employee)" title="Editar">
                  <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
                    <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
                  </svg>
                </button>
                <button class="btn-icon btn-delete" (click)="confirmDelete(employee)" title="Eliminar">
                  <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <polyline points="3 6 5 6 21 6"></polyline>
                    <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
                    <line x1="10" y1="11" x2="10" y2="17"></line>
                    <line x1="14" y1="11" x2="14" y2="17"></line>
                  </svg>
                </button>
              </div>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
  </main>
</div>

<!-- Modal Create/Edit Employee -->
<div class="modal-overlay" *ngIf="showModal" (click)="closeModal()">
  <div class="modal-content" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h2>{{ isEditMode ? 'Editar Empleado' : 'Nuevo Empleado' }}</h2>
      <button class="btn-close" (click)="closeModal()">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <line x1="18" y1="6" x2="6" y2="18"></line>
          <line x1="6" y1="6" x2="18" y2="18"></line>
        </svg>
      </button>
    </div>

    <form [formGroup]="employeeForm" (ngSubmit)="saveEmployee()" class="modal-body">
      <div class="form-row">
        <div class="form-group">
          <label for="code">Código *</label>
          <input
            type="text"
            id="code"
            formControlName="code"
            placeholder="Ej: EMP001"
            [class.error]="employeeForm.get('code')?.invalid && employeeForm.get('code')?.touched"
          />
          <span class="error-message" *ngIf="employeeForm.get('code')?.hasError('required') && employeeForm.get('code')?.touched">
            El código es requerido
          </span>
        </div>

        <div class="form-group">
          <label for="departmentCode">Código Departamento *</label>
          <input
            type="text"
            id="departmentCode"
            formControlName="departmentCode"
            placeholder="Ej: IT"
            [class.error]="employeeForm.get('departmentCode')?.invalid && employeeForm.get('departmentCode')?.touched"
          />
          <span class="error-message" *ngIf="employeeForm.get('departmentCode')?.hasError('required') && employeeForm.get('departmentCode')?.touched">
            El departamento es requerido
          </span>
        </div>
      </div>

      <div class="form-group">
        <label for="firstName">Nombre *</label>
        <input
          type="text"
          id="firstName"
          formControlName="firstName"
          placeholder="Nombre del empleado"
          [class.error]="employeeForm.get('firstName')?.invalid && employeeForm.get('firstName')?.touched"
        />
        <span class="error-message" *ngIf="employeeForm.get('firstName')?.hasError('required') && employeeForm.get('firstName')?.touched">
          El nombre es requerido
        </span>
      </div>

      <div class="form-row">
        <div class="form-group">
          <label for="lastName1">Primer Apellido *</label>
          <input
            type="text"
            id="lastName1"
            formControlName="lastName1"
            placeholder="Primer apellido"
            [class.error]="employeeForm.get('lastName1')?.invalid && employeeForm.get('lastName1')?.touched"
          />
          <span class="error-message" *ngIf="employeeForm.get('lastName1')?.hasError('required') && employeeForm.get('lastName1')?.touched">
            El primer apellido es requerido
          </span>
        </div>

        <div class="form-group">
          <label for="lastName2">Segundo Apellido</label>
          <input
            type="text"
            id="lastName2"
            formControlName="lastName2"
            placeholder="Segundo apellido (opcional)"
          />
        </div>
      </div>

      <div class="error-message" *ngIf="modalErrorMessage">
        {{ modalErrorMessage }}
      </div>

      <div class="modal-footer">
        <button type="button" class="btn-secondary" (click)="closeModal()" [disabled]="modalLoading">Cancelar</button>
        <button type="submit" class="btn-primary" [disabled]="employeeForm.invalid || modalLoading">
          <span *ngIf="!modalLoading">{{ isEditMode ? 'Guardar Cambios' : 'Crear Empleado' }}</span>
          <span *ngIf="modalLoading" class="loading-spinner"></span>
        </button>
      </div>
    </form>
  </div>
</div>

<!-- Modal Delete Confirmation -->
<div class="modal-overlay" *ngIf="showDeleteModal" (click)="closeDeleteModal()">
  <div class="modal-content modal-small" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h2>Confirmar Eliminación</h2>
      <button class="btn-close" (click)="closeDeleteModal()">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <line x1="18" y1="6" x2="6" y2="18"></line>
          <line x1="6" y1="6" x2="18" y2="18"></line>
        </svg>
      </button>
    </div>

    <div class="modal-body">
      <div class="delete-warning">
        <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <circle cx="12" cy="12" r="10"></circle>
          <line x1="12" y1="8" x2="12" y2="12"></line>
          <line x1="12" y1="16" x2="12.01" y2="16"></line>
        </svg>
        <p>¿Estás seguro de que deseas eliminar a <strong>{{ employeeToDelete?.firstName }} {{ employeeToDelete?.lastName1 }}</strong>?</p>
        <p class="warning-text">Esta acción no se puede deshacer.</p>
      </div>

      <div class="error-message" *ngIf="deleteErrorMessage">
        {{ deleteErrorMessage }}
      </div>

      <div class="modal-footer">
        <button type="button" class="btn-secondary" (click)="closeDeleteModal()" [disabled]="deleteLoading">Cancelar</button>
        <button type="button" class="btn-danger" (click)="deleteEmployee()" [disabled]="deleteLoading">
          <span *ngIf="!deleteLoading">Eliminar</span>
          <span *ngIf="deleteLoading" class="loading-spinner"></span>
        </button>
      </div>
    </div>
  </div>
</div>
